<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker Pro - Date Wise</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s;
        }
        body.dark-mode {
            background: linear-gradient(135deg, #121212 0%, #1a1a2e 100%);
        }
        .container {
            max-width: 1400px; margin: 0 auto;
            background: rgba(255,255,255,0.95); border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); backdrop-filter: blur(10px);
            transition: all 0.3s;
        }
        body.dark-mode .container {
            background: rgba(30,30,40,0.95);
            color: #ffffff;
        }
        .header { text-align: center; padding: 30px; background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%); color: white; border-radius: 20px 20px 0 0; }
        body.dark-mode .header { background: linear-gradient(45deg, #2d3748 0%, #4a5568 100%); }
        
        .tabs { display: flex; justify-content: center; margin: 20px 0; background: white; border-radius: 50px; padding: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); flex-wrap: wrap; }
        body.dark-mode .tabs { background: #2d3748; }
        .tab-btn { padding: 12px 24px; border: none; background: none; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; margin: 2px; }
        .tab-btn.active { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; transform: translateY(-2px); }
        
        /* Top Controls */
        .top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: rgba(255,255,255,0.9);
            margin: 0 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        body.dark-mode .top-controls {
            background: rgba(45,55,72,0.9);
        }
        .control-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin: 0 5px;
        }
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }
        .mode-toggle {
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
        }

        /* Achievement System */
        .achievements-section {
            margin: 20px 30px;
            padding: 20px;
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            border-radius: 15px;
            display: none;
        }
        body.dark-mode .achievements-section {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        }
        .achievements-section.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .achievement-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        body.dark-mode .achievement-card {
            background: #4a5568;
        }
        .achievement-card:hover {
            transform: translateY(-3px);
        }
        .achievement-card.locked {
            opacity: 0.6;
        }
        .achievement-icon {
            font-size: 40px;
            margin-right: 15px;
        }
        .achievement-progress {
            flex-grow: 1;
            margin-top: 10px;
        }
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #43e97b, #36d399);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Enhanced Habit Form */
        .add-habit-form {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 30px;
            border-radius: 20px;
            margin: 30px;
        }
        body.dark-mode .add-habit-form {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        body.dark-mode .form-group label {
            color: #e2e8f0;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background: #2d3748;
            border-color: #4a5568;
            color: white;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79,172,254,0.1);
        }

        /* Enhanced Habits Table */
        .habits-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin: 30px 0;
        }
        body.dark-mode .habits-table {
            background: #2d3748;
        }
        .habits-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .habits-table td {
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s;
        }
        body.dark-mode .habits-table td {
            border-color: #4a5568;
        }
        .habits-table tr:hover {
            background: #f8f9ff;
            transform: scale(1.01);
        }
        body.dark-mode .habits-table tr:hover {
            background: #4a5568;
        }
        .habit-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .category-health { background: #4ade80; color: white; }
        .category-work { background: #60a5fa; color: white; }
        .category-personal { background: #c084fc; color: white; }
        .category-fitness { background: #f472b6; color: white; }
        .category-other { background: #94a3b8; color: white; }

        .habit-notes-btn {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.3s;
        }
        .habit-notes-btn:hover {
            background: #7c3aed;
            transform: scale(1.05);
        }

        /* Notes Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        body.dark-mode .modal-content {
            background: #2d3748;
            color: white;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        body.dark-mode .close-modal {
            color: #e2e8f0;
        }

        /* Date Navigation */
        .date-nav { display: flex; align-items: center; justify-content: space-between; margin: 20px 30px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        body.dark-mode .date-nav { background: #2d3748; }
        .date-display { font-size: 24px; font-weight: 700; color: #333; }
        body.dark-mode .date-display { color: #e2e8f0; }
        .nav-btn { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(79,172,254,0.4); }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* Calendar View */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin: 20px 30px; }
        .calendar-day { aspect-ratio: 1; border: 2px solid #e1e5e9; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; font-weight: 600; padding: 5px; }
        body.dark-mode .calendar-day { border-color: #4a5568; }
        .calendar-day:hover { transform: scale(1.05); }
        .calendar-day.today { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; }
        .calendar-day.completed { background: linear-gradient(45deg, #43e97b, #36d399); color: white; animation: pulse 0.6s; }
        .calendar-day.other-month { opacity: 0.3; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* Analytics Cards */
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin: 30px; }
        .stat-card { background: white; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: all 0.3s; }
        body.dark-mode .stat-card { background: #2d3748; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 48px; font-weight: 800; background: linear-gradient(45deg, #4facfe, #00f2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 10px; }
        .stat-label { color: #666; font-weight: 600; }
        body.dark-mode .stat-label { color: #cbd5e0; }

        .chart-container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); height: 450px; margin: 30px; }
        body.dark-mode .chart-container { background: #2d3748; }

        .streak-badge { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .success-badge { background: linear-gradient(45deg, #43e97b, #36d399); color: white; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }

        .btn { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 15px rgba(79,172,254,0.3); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(79,172,254,0.4); }
        .delete-btn { background: #ff6b6b; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; transition: all 0.3s; }
        .delete-btn:hover { background: #ff5252; transform: scale(1.05); }

        /* Offline Status */
        .offline-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .offline-status.online {
            background: #43e97b;
            color: white;
        }
        .offline-status.offline {
            background: #ff6b6b;
            color: white;
        }

        /* Progress Notes */
        .progress-notes {
            margin: 20px 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        body.dark-mode .progress-notes {
            background: #2d3748;
        }

        /* Tab Content Animation */
        .tab-content { display: none; animation: slideIn 0.5s ease; }
        .tab-content.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            .habits-table th, .habits-table td { padding: 15px 10px; font-size: 14px; }
            .calendar-grid { grid-template-columns: repeat(4, 1fr); margin: 20px 15px; }
            .analytics-grid { grid-template-columns: 1fr; margin: 20px 15px; }
            .top-controls { flex-direction: column; gap: 15px; padding: 15px; margin: 0 15px; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="offline-status online" id="offlineStatus">‚úÖ Online</div>
    
    <div class="container">
        <div class="header">
            <h1>üìä Habit Tracker Pro</h1>
            <p>Date-wise tracking + Historical Analytics</p>
            <div style="margin-top: 10px; display: flex; justify-content: center; gap: 10px;">
                <span id="storageStatus">Storage: Loading...</span>
                <span class="mode-toggle" id="darkModeToggle">üåô</span>
            </div>
        </div>

        <div class="top-controls">
            <div>
                <button class="control-btn" onclick="toggleAchievements()">üèÜ Achievements</button>
                <button class="control-btn" onclick="exportData()">üì§ Export Data</button>
                <button class="control-btn" onclick="importData()">üì• Import Data</button>
                <button class="control-btn" onclick="showReminderSettings()">‚è∞ Reminders</button>
            </div>
            <div>
                <button class="control-btn" onclick="showProgressNotes()">üìù Progress Notes</button>
                <button class="control-btn" onclick="clearAllData()">üóëÔ∏è Clear All</button>
            </div>
        </div>

        <!-- Achievements Section -->
        <div class="achievements-section" id="achievementsSection">
            <h2 style="margin-bottom: 20px;">üèÜ Achievements & Goals</h2>
            <div class="achievement-grid" id="achievementsGrid"></div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('calendar')">üìÖ Calendar</button>
            <button class="tab-btn" onclick="showTab('today')">üìã Today</button>
            <button class="tab-btn" onclick="showTab('analytics')">üìà Analytics</button>
            <button class="tab-btn" onclick="showTab('streaks')">üî• Streaks</button>
        </div>

        <!-- Calendar View -->
        <div id="calendar" class="tab-content active">
            <div class="date-nav">
                <button class="nav-btn" onclick="changeMonth(-1)">‚¨ÖÔ∏è Previous</button>
                <div class="date-display" id="currentMonth">January 2026</div>
                <button class="nav-btn" onclick="changeMonth(1)">Next ‚û°Ô∏è</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <!-- Today Habits -->
        <div id="today" class="tab-content">
            <div class="date-nav">
                <div class="date-display" id="todayDate"></div>
            </div>
            
            <div class="add-habit-form">
                <h3 style="margin-bottom: 20px;">‚ûï ‡§®‡§Ø‡§æ Habit ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Habit ‡§ï‡§æ ‡§®‡§æ‡§Æ:</label>
                        <input type="text" id="habitName" placeholder="‡§ú‡•à‡§∏‡•á: ‡§™‡§æ‡§®‡•Ä ‡§™‡•Ä‡§®‡§æ, ‡§µ‡•ç‡§Ø‡§æ‡§Ø‡§æ‡§Æ..." />
                    </div>
                    <div class="form-group">
                        <label>Category:</label>
                        <select id="habitCategory">
                            <option value="health">‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø (Health)</option>
                            <option value="work">‡§ï‡§æ‡§Æ (Work)</option>
                            <option value="personal">‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ (Personal)</option>
                            <option value="fitness">‡§´‡§ø‡§ü‡§®‡•á‡§∏ (Fitness)</option>
                            <option value="other">‡§Ö‡§®‡•ç‡§Ø (Other)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes (Optional):</label>
                    <textarea id="habitNotes" placeholder="‡§á‡§∏ habit ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§®‡•ã‡§ü‡•ç‡§∏..." rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Daily Goal Time:</label>
                    <input type="time" id="habitTime" />
                </div>
                <button class="btn" onclick="addHabit()">‚ûï Add Habit</button>
            </div>
            
            <table class="habits-table" id="habitsTable">
                <thead>
                    <tr>
                        <th>Habit</th>
                        <th>Category</th>
                        <th>Done?</th>
                        <th>Streak</th>
                        <th>Success</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="habitsBody"></tbody>
            </table>
        </div>

        <!-- Analytics -->
        <div id="analytics" class="tab-content">
            <div class="analytics-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalHabits">0</div>
                    <div class="stat-label">Total Habits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentStreak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="bestStreak">0</div>
                    <div class="stat-label">Best Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalDays">0</div>
                    <div class="stat-label">Days Tracked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="achievementsCount">0</div>
                    <div class="stat-label">Achievements</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completionRate">0%</div>
                    <div class="stat-label">Overall Rate</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="habitsChart"></canvas>
            </div>
            <div style="margin: 30px; padding: 20px; background: white; border-radius: 20px;">
                <h3>Weekly Success Rate</h3>
                <canvas id="weeklyChart" height="200"></canvas>
            </div>
        </div>

        <!-- Streaks View -->
        <div id="streaks" class="tab-content">
            <div style="margin: 30px;">
                <h2>üî• Habit Streaks Calendar</h2>
                <p style="color: #666; margin-bottom: 20px;">Your 30-day streak visualization</p>
                <div id="streakCalendar" style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px;"></div>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div class="modal" id="notesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Habit Notes</h3>
                <button class="close-modal" onclick="closeModal()">‚úï</button>
            </div>
            <div id="modalContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Reminder Settings Modal -->
    <div class="modal" id="reminderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚è∞ Daily Reminders</h3>
                <button class="close-modal" onclick="closeModal()">‚úï</button>
            </div>
            <div style="margin-top: 20px;">
                <div class="form-group">
                    <label>Enable Daily Reminders:</label>
                    <input type="checkbox" id="enableReminders" style="width: auto; margin-left: 10px;">
                </div>
                <div class="form-group">
                    <label>Reminder Time:</label>
                    <input type="time" id="reminderTime" value="09:00">
                </div>
                <div class="form-group">
                    <label>Reminder Message:</label>
                    <textarea id="reminderMessage" rows="3">Don't forget to track your habits today! üí™</textarea>
                </div>
                <button class="btn" onclick="saveReminderSettings()" style="width: 100%;">üíæ Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Progress Notes Modal -->
    <div class="modal" id="progressNotesModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>üìù Daily Progress Notes</h3>
                <button class="close-modal" onclick="closeModal()">‚úï</button>
            </div>
            <div style="margin-top: 20px;">
                <div class="form-group">
                    <label>Today's Date:</label>
                    <input type="date" id="progressDate" style="width: 200px;">
                </div>
                <div class="form-group">
                    <label>How was your day?</label>
                    <textarea id="progressText" rows="6" placeholder="Write about your progress, challenges, and achievements today..."></textarea>
                </div>
                <button class="btn" onclick="saveProgressNote()">üíæ Save Note</button>
                <button class="btn" onclick="loadProgressNotes()" style="background: linear-gradient(45deg, #667eea, #764ba2); margin-left: 10px;">üìñ View History</button>
                
                <div id="progressHistory" style="margin-top: 30px; max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script>
        // Main Data Structure
        let habits = JSON.parse(localStorage.getItem('habits')) || [];
        let achievements = JSON.parse(localStorage.getItem('achievements')) || [];
        let progressNotes = JSON.parse(localStorage.getItem('progressNotes')) || [];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            darkMode: false,
            reminders: false,
            reminderTime: "09:00",
            reminderMessage: "Don't forget to track your habits today! üí™"
        };
        
        let currentDate = new Date();
        let currentMonthView = new Date();
        let chart = null, weeklyChart = null;
        let selectedHabitId = null;

        // Achievement Definitions
        const ACHIEVEMENTS = [
            { id: 'first_habit', title: 'First Step', description: 'Add your first habit', icon: 'üöÄ', target: 1, type: 'habits' },
            { id: 'seven_days', title: 'One Week', description: 'Complete habits for 7 consecutive days', icon: 'üìÖ', target: 7, type: 'streak' },
            { id: 'thirty_days', title: 'One Month', description: 'Complete habits for 30 consecutive days', icon: 'üèÜ', target: 30, type: 'streak' },
            { id: 'perfect_week', title: 'Perfect Week', description: 'Complete all habits every day for a week', icon: '‚≠ê', target: 7, type: 'perfect' },
            { id: 'five_habits', title: 'Habit Collector', description: 'Maintain 5 active habits', icon: 'üìä', target: 5, type: 'habits' },
            { id: 'ninety_days', title: 'Quarter Master', description: '90 days of habit tracking', icon: 'üëë', target: 90, type: 'streak' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            checkOfflineStatus();
            updateStorageStatus();
            
            // Check for achievements on load
            setTimeout(checkAchievements, 1000);
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // Set up daily reminders
            setupReminders();
            
            // Load progress notes
            loadProgressNotes();
        });

        function initApp() {
            updateTodayDate();
            renderCalendar();
            renderHabits();
            updateAnalytics();
            renderAchievements();
            
            // Set up dark mode
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').textContent = '‚òÄÔ∏è';
            }
            
            // Set up event listeners
            document.getElementById('habitName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addHabit();
            });
            
            // Check for notification support
            checkNotificationSupport();
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'today') renderHabits();
            if (tabName === 'analytics') updateAnalytics();
            if (tabName === 'streaks') renderStreakCalendar();
        }

        // Date functions
        function getDateKey(date) { 
            return date.toISOString().split('T')[0]; // YYYY-MM-DD format
        }
        
        function updateTodayDate() {
            document.getElementById('todayDate').textContent = currentDate.toLocaleDateString('hi-IN', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
        }

        // Calendar functions
        function renderCalendar() {
            const year = currentMonthView.getFullYear();
            const month = currentMonthView.getMonth();
            document.getElementById('currentMonth').textContent = 
                currentMonthView.toLocaleDateString('hi-IN', { year: 'numeric', month: 'long' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            let html = '<div style="grid-column: 1/-1; text-align: center; margin: 20px 0; font-weight: 600; color: #666;">‡§∏‡•ã‡§Æ ‡§µ‡§ø ‡§Æ‡§Ç ‡§¨‡•Å ‡§ó‡•Å‡§∞ ‡§∂‡•Å ‡§∂‡§®‡§ø</div>';
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateKey = getDateKey(date);
                const isCurrentMonth = date.getMonth() === month;
                const isToday = dateKey === getDateKey(new Date());
                const completedCount = habits.filter(h => h.history[dateKey] || false).length;
                const totalHabits = habits.length;
                const completionRate = totalHabits > 0 ? Math.round((completedCount / totalHabits) * 100) : 0;
                
                let className = 'calendar-day';
                if (!isCurrentMonth) className += ' other-month';
                if (isToday) className += ' today';
                if (completedCount > 0) className += ' completed';
                
                html += `<div class="${className}" onclick="viewDate('${dateKey}')" 
                         style="background: linear-gradient(135deg, rgba(67, 233, 123, ${completedCount/totalHabits}), rgba(54, 211, 153, ${completedCount/totalHabits}))">
                    <div style="font-size: 1.2em; font-weight: 700;">${date.getDate()}</div>
                    <div style="font-size: 0.8em; margin-top: 5px;">${completionRate}%</div>
                </div>`;
            }
            document.getElementById('calendarGrid').innerHTML = html;
        }

        function changeMonth(direction) {
            currentMonthView.setMonth(currentMonthView.getMonth() + direction);
            renderCalendar();
        }

        function viewDate(dateKey) {
            currentDate = new Date(dateKey);
            updateTodayDate();
            showTab('today');
            renderHabits();
        }

        // Habit functions
        function addHabit() {
            const name = document.getElementById('habitName').value.trim();
            const category = document.getElementById('habitCategory').value;
            const notes = document.getElementById('habitNotes').value.trim();
            const time = document.getElementById('habitTime').value;
            
            if (!name) {
                alert('Please enter a habit name');
                return;
            }
            
            const habit = { 
                id: Date.now(), 
                name, 
                category,
                notes,
                goalTime: time,
                history: {},
                createdAt: new Date().toISOString(),
                streak: 0,
                bestStreak: 0
            };
            
            habits.push(habit);
            saveData();
            document.getElementById('habitName').value = '';
            document.getElementById('habitNotes').value = '';
            document.getElementById('habitTime').value = '';
            renderHabits();
            
            // Check for achievements
            checkAchievements();
            
            // Show success message
            showNotification('Habit added successfully!', 'success');
        }

        function renderHabits() {
            const tbody = document.getElementById('habitsBody');
            const dateKey = getDateKey(currentDate);
            tbody.innerHTML = '';

            if (habits.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                    No habits yet. Add your first habit above!
                </td></tr>`;
                return;
            }

            habits.forEach(habit => {
                const completed = habit.history[dateKey] || false;
                const streak = calculateStreak(habit);
                const successRate = calculateSuccessRate(habit);
                const categoryClass = `category-${habit.category || 'other'}`;
                const categoryText = getCategoryText(habit.category);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 600; color: #333;">
                        ${habit.name}
                        ${habit.goalTime ? `<br><small style="color: #666;">‚è∞ ${habit.goalTime}</small>` : ''}
                    </td>
                    <td><span class="habit-category ${categoryClass}">${categoryText}</span></td>
                    <td><input type="checkbox" class="habit-checkbox" ${completed ? 'checked' : ''} 
                               onchange="toggleHabit(${habit.id}, '${dateKey}')" style="transform: scale(1.5);"></td>
                    <td><span class="streak-badge">${streak} üî•</span></td>
                    <td><span class="success-badge">${successRate}%</span></td>
                    <td>
                        <button class="habit-notes-btn" onclick="showHabitNotes(${habit.id})">üìù</button>
                        <button class="delete-btn" onclick="deleteHabit(${habit.id})">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getCategoryText(category) {
            const categories = {
                'health': '‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø',
                'work': '‡§ï‡§æ‡§Æ',
                'personal': '‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§',
                'fitness': '‡§´‡§ø‡§ü‡§®‡•á‡§∏',
                'other': '‡§Ö‡§®‡•ç‡§Ø'
            };
            return categories[category] || category;
        }

        function toggleHabit(habitId, dateKey) {
            const habit = habits.find(h => h.id === habitId);
            if (habit) {
                habit.history[dateKey] = !habit.history[dateKey];
                habit.streak = calculateStreak(habit);
                habit.bestStreak = Math.max(habit.bestStreak, habit.streak);
                saveData();
                renderHabits();
                renderCalendar();
                updateAnalytics();
                
                // Check for achievements
                checkAchievements();
                
                // Update streak calendar
                renderStreakCalendar();
                
                // Show notification
                const status = habit.history[dateKey] ? 'completed' : 'unmarked';
                showNotification(`Habit ${status}!`, status === 'completed' ? 'success' : 'info');
            }
        }

        function deleteHabit(habitId) {
            if (confirm('Are you sure you want to delete this habit?')) {
                habits = habits.filter(h => h.id !== habitId);
                saveData();
                renderHabits();
                renderCalendar();
                updateAnalytics();
                showNotification('Habit deleted', 'warning');
            }
        }

        function showHabitNotes(habitId) {
            const habit = habits.find(h => h.id === habitId);
            if (!habit) return;
            
            selectedHabitId = habitId;
            document.getElementById('modalTitle').textContent = `Notes: ${habit.name}`;
            
            let notesHTML = `<p><strong>Category:</strong> ${getCategoryText(habit.category)}</p>`;
            if (habit.goalTime) {
                notesHTML += `<p><strong>Goal Time:</strong> ${habit.goalTime}</p>`;
            }
            notesHTML += `<p><strong>Created:</strong> ${new Date(habit.createdAt).toLocaleDateString()}</p>`;
            notesHTML += `<p><strong>Current Streak:</strong> ${calculateStreak(habit)} days</p>`;
            notesHTML += `<p><strong>Best Streak:</strong> ${habit.bestStreak || 0} days</p>`;
            notesHTML += `<p><strong>Success Rate:</strong> ${calculateSuccessRate(habit)}%</p>`;
            
            notesHTML += `<div style="margin-top: 20px;">
                <label><strong>Edit Notes:</strong></label>
                <textarea id="editHabitNotes" rows="5" style="width: 100%; margin-top: 10px; padding: 10px;">${habit.notes || ''}</textarea>
                <button class="btn" onclick="updateHabitNotes()" style="margin-top: 15px;">üíæ Save Notes</button>
            </div>`;
            
            document.getElementById('modalContent').innerHTML = notesHTML;
            document.getElementById('notesModal').classList.add('active');
        }

        function updateHabitNotes() {
            if (!selectedHabitId) return;
            
            const habit = habits.find(h => h.id === selectedHabitId);
            if (habit) {
                habit.notes = document.getElementById('editHabitNotes').value;
                saveData();
                showNotification('Notes updated!', 'success');
                closeModal();
            }
        }

        // Achievement System
        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            if (!grid) return;
            
            let html = '';
            ACHIEVEMENTS.forEach(achievement => {
                const userAchievement = achievements.find(a => a.id === achievement.id) || {
                    id: achievement.id,
                    progress: 0,
                    unlocked: false,
                    unlockedAt: null
                };
                
                const progress = userAchievement.progress;
                const percentage = Math.min(Math.round((progress / achievement.target) * 100), 100);
                const isLocked = !userAchievement.unlocked;
                
                html += `
                    <div class="achievement-card ${isLocked ? 'locked' : ''}">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div style="flex-grow: 1;">
                            <h4 style="margin-bottom: 5px;">${achievement.title}</h4>
                            <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">${achievement.description}</p>
                            <div class="achievement-progress">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>Progress: ${progress}/${achievement.target}</span>
                                    <span>${percentage}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                            ${userAchievement.unlocked ? 
                                `<div style="margin-top: 10px; color: #43e97b; font-weight: 600;">
                                    ‚úÖ Unlocked on ${new Date(userAchievement.unlockedAt).toLocaleDateString()}
                                </div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }

        function checkAchievements() {
            let updated = false;
            
            ACHIEVEMENTS.forEach(achievement => {
                let progress = 0;
                let currentAchievement = achievements.find(a => a.id === achievement.id);
                
                if (currentAchievement && currentAchievement.unlocked) return;
                
                switch(achievement.type) {
                    case 'habits':
                        if (achievement.id === 'first_habit') {
                            progress = habits.length > 0 ? 1 : 0;
                        } else if (achievement.id === 'five_habits') {
                            progress = Math.min(habits.length, achievement.target);
                        }
                        break;
                        
                    case 'streak':
                        const longestStreak = habits.reduce((max, h) => Math.max(max, calculateStreak(h)), 0);
                        progress = Math.min(longestStreak, achievement.target);
                        break;
                        
                    case 'perfect':
                        // Check for perfect days in last 7 days
                        let perfectDays = 0;
                        for (let i = 0; i < achievement.target; i++) {
                            const date = new Date();
                            date.setDate(date.getDate() - i);
                            const dateKey = getDateKey(date);
                            const completedCount = habits.filter(h => h.history[dateKey]).length;
                            if (completedCount === habits.length && habits.length > 0) {
                                perfectDays++;
                            }
                        }
                        progress = perfectDays;
                        break;
                }
                
                if (!currentAchievement) {
                    currentAchievement = {
                        id: achievement.id,
                        progress: progress,
                        unlocked: progress >= achievement.target,
                        unlockedAt: progress >= achievement.target ? new Date().toISOString() : null
                    };
                    achievements.push(currentAchievement);
                    updated = true;
                } else {
                    if (progress > currentAchievement.progress) {
                        currentAchievement.progress = progress;
                        if (progress >= achievement.target && !currentAchievement.unlocked) {
                            currentAchievement.unlocked = true;
                            currentAchievement.unlockedAt = new Date().toISOString();
                            showAchievementUnlocked(achievement);
                            updated = true;
                        }
                    }
                }
            });
            
            if (updated) {
                saveData();
                renderAchievements();
                updateAnalytics();
            }
        }

        function showAchievementUnlocked(achievement) {
            showNotification(`üèÜ Achievement Unlocked: ${achievement.title}`, 'success');
            
            // Create a temporary celebration effect
            const celebration = document.createElement('div');
            celebration.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                           background: linear-gradient(45deg, #FFD700, #FFA500); padding: 30px; 
                           border-radius: 20px; z-index: 10000; box-shadow: 0 0 50px rgba(255,215,0,0.5);
                           text-align: center; color: white; min-width: 300px;">
                    <div style="font-size: 60px; margin-bottom: 20px;">${achievement.icon}</div>
                    <h2 style="margin-bottom: 10px;">Achievement Unlocked!</h2>
                    <h3 style="margin-bottom: 10px;">${achievement.title}</h3>
                    <p>${achievement.description}</p>
                    <button onclick="this.parentElement.remove()" 
                            style="margin-top: 20px; padding: 10px 20px; background: white; 
                                   color: #FFA500; border: none; border-radius: 10px; cursor: pointer;">
                        Awesome! üëç
                    </button>
                </div>
            `;
            document.body.appendChild(celebration);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (celebration.parentElement) {
                    celebration.remove();
                }
            }, 5000);
        }

        function toggleAchievements() {
            const section = document.getElementById('achievementsSection');
            section.classList.toggle('active');
            if (section.classList.contains('active')) {
                renderAchievements();
            }
        }

        // Streak Calendar
        function renderStreakCalendar() {
            const container = document.getElementById('streakCalendar');
            if (!container) return;
            
            let html = '';
            const today = new Date();
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateKey = getDateKey(date);
                
                const completedCount = habits.filter(h => h.history[dateKey]).length;
                const totalHabits = habits.length;
                const percentage = totalHabits > 0 ? (completedCount / totalHabits) : 0;
                
                let color;
                if (percentage === 0) color = '#e2e8f0';
                else if (percentage < 0.5) color = '#86efac';
                else if (percentage < 1) color = '#4ade80';
                else color = '#16a34a';
                
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const dayNum = date.getDate();
                
                html += `
                    <div style="text-align: center; padding: 10px 5px; border-radius: 8px; background: ${color};">
                        <div style="font-size: 0.8em; color: ${percentage > 0 ? 'white' : '#666'};">
                            ${dayName}
                        </div>
                        <div style="font-weight: 700; color: ${percentage > 0 ? 'white' : '#666'};">
                            ${dayNum}
                        </div>
                        <div style="font-size: 0.7em; color: ${percentage > 0 ? 'white' : '#666'};">
                            ${completedCount}/${totalHabits}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // Analytics
        function calculateStreak(habit) {
            const dates = Object.keys(habit.history)
                .map(d => new Date(d))
                .sort((a, b) => b - a);
            
            if (dates.length === 0) return 0;
            
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Check today first
            const todayKey = getDateKey(today);
            if (habit.history[todayKey]) {
                streak = 1;
            }
            
            // Count backwards
            let currentDate = new Date(today);
            currentDate.setDate(currentDate.getDate() - 1);
            
            while (true) {
                const dateKey = getDateKey(currentDate);
                if (habit.history[dateKey]) {
                    streak++;
                    currentDate.setDate(currentDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function calculateSuccessRate(habit) {
            const totalDays = Object.keys(habit.history).length;
            if (!totalDays) return 0;
            const completed = Object.values(habit.history).filter(Boolean).length;
            return Math.round((completed / totalDays) * 100);
        }

        function updateAnalytics() {
            document.getElementById('totalHabits').textContent = habits.length;
            
            let maxStreak = 0;
            let totalDays = 0;
            let totalCompletions = 0;
            let unlockedAchievements = achievements.filter(a => a.unlocked).length;
            
            habits.forEach(habit => {
                const streak = calculateStreak(habit);
                maxStreak = Math.max(maxStreak, streak);
                totalDays += Object.keys(habit.history).length;
                totalCompletions += Object.values(habit.history).filter(Boolean).length;
            });

            const overallCompletionRate = habits.length > 0 ? 
                Math.round((totalCompletions / (habits.length * totalDays)) * 100) || 0 : 0;
            
            document.getElementById('currentStreak').textContent = habits.length > 0 ? 
                habits.reduce((max, h) => Math.max(max, calculateStreak(h)), 0) : 0;
            document.getElementById('bestStreak').textContent = maxStreak;
            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('achievementsCount').textContent = unlockedAchievements;
            document.getElementById('completionRate').textContent = `${overallCompletionRate}%`;

            updateCharts();
        }

        function updateCharts() {
            // Main habits chart
            const ctx = document.getElementById('habitsChart').getContext('2d');
            if (chart) chart.destroy();
            
            if (habits.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '20px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('No habits to display', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            const labels = habits.map(h => h.name.slice(0, 15) + (h.name.length > 15 ? '...' : ''));
            const data = habits.map(h => calculateSuccessRate(h));
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: { 
                    labels, 
                    datasets: [{ 
                        data, 
                        backgroundColor: ['#4facfe','#00f2fe','#43e97b','#fa709a','#feb41c','#ff6b6b','#4ecdc4'] 
                    }] 
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'bottom',
                            labels: {
                                color: settings.darkMode ? '#e2e8f0' : '#666'
                            }
                        } 
                    } 
                }
            });

            // Weekly chart
            const wctx = document.getElementById('weeklyChart').getContext('2d');
            if (weeklyChart) weeklyChart.destroy();
            const weekDays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
            const weekData = weekDays.map((_, i) => {
                const date = new Date();
                date.setDate(date.getDate() - date.getDay() + i);
                return habits.reduce((sum, h) => sum + (h.history[getDateKey(date)] ? 1 : 0), 0);
            });
            
            weeklyChart = new Chart(wctx, {
                type: 'bar',
                data: { 
                    labels: weekDays, 
                    datasets: [{ 
                        label: 'Habits Done', 
                        data: weekData, 
                        backgroundColor: '#4facfe' 
                    }] 
                },
                options: { 
                    responsive: true, 
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            max: habits.length,
                            ticks: {
                                color: settings.darkMode ? '#e2e8f0' : '#666'
                            }
                        },
                        x: {
                            ticks: {
                                color: settings.darkMode ? '#e2e8f0' : '#666'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: settings.darkMode ? '#e2e8f0' : '#666'
                            }
                        }
                    }
                }
            });
        }

        // Progress Notes
        function showProgressNotes() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('progressDate').value = today;
            document.getElementById('progressText').value = '';
            document.getElementById('progressHistory').innerHTML = '';
            
            document.getElementById('progressNotesModal').classList.add('active');
        }

        function saveProgressNote() {
            const date = document.getElementById('progressDate').value;
            const text = document.getElementById('progressText').value.trim();
            
            if (!text) {
                alert('Please enter some text for your progress note');
                return;
            }
            
            // Remove existing note for this date
            progressNotes = progressNotes.filter(note => note.date !== date);
            
            // Add new note
            progressNotes.push({
                date,
                text,
                createdAt: new Date().toISOString()
            });
            
            saveData();
            showNotification('Progress note saved!', 'success');
            loadProgressNotes();
            document.getElementById('progressText').value = '';
        }

        function loadProgressNotes() {
            const historyDiv = document.getElementById('progressHistory');
            
            if (progressNotes.length === 0) {
                historyDiv.innerHTML = '<p style="text-align: center; color: #666;">No progress notes yet.</p>';
                return;
            }
            
            // Sort by date (newest first)
            const sortedNotes = [...progressNotes].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '<h4>Previous Notes:</h4>';
            sortedNotes.forEach(note => {
                const dateObj = new Date(note.date);
                html += `
                    <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 10px;">
                        <div style="font-weight: 600; color: #4facfe; margin-bottom: 5px;">
                            ${dateObj.toLocaleDateString('hi-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                        <div style="color: #555;">${note.text}</div>
                        <button onclick="deleteProgressNote('${note.date}')" 
                                style="margin-top: 10px; padding: 5px 10px; background: #ff6b6b; 
                                       color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                            Delete
                        </button>
                    </div>
                `;
            });
            
            historyDiv.innerHTML = html;
        }

        function deleteProgressNote(date) {
            if (confirm('Delete this progress note?')) {
                progressNotes = progressNotes.filter(note => note.date !== date);
                saveData();
                loadProgressNotes();
                showNotification('Note deleted', 'warning');
            }
        }

        // Reminder System
        function showReminderSettings() {
            document.getElementById('enableReminders').checked = settings.reminders;
            document.getElementById('reminderTime').value = settings.reminderTime;
            document.getElementById('reminderMessage').value = settings.reminderMessage;
            document.getElementById('reminderModal').classList.add('active');
        }

        function saveReminderSettings() {
            settings.reminders = document.getElementById('enableReminders').checked;
            settings.reminderTime = document.getElementById('reminderTime').value;
            settings.reminderMessage = document.getElementById('reminderMessage').value;
            
            saveData();
            setupReminders();
            showNotification('Reminder settings saved!', 'success');
            closeModal();
        }

        function setupReminders() {
            if (!settings.reminders) return;
            
            // Clear existing reminders
            if (window.reminderInterval) {
                clearInterval(window.reminderInterval);
            }
            
            // Set up daily reminder
            const now = new Date();
            const [hours, minutes] = settings.reminderTime.split(':').map(Number);
            const reminderTime = new Date();
            reminderTime.setHours(hours, minutes, 0, 0);
            
            if (now > reminderTime) {
                reminderTime.setDate(reminderTime.getDate() + 1);
            }
            
            const timeUntilReminder = reminderTime - now;
            
            setTimeout(() => {
                showReminder();
                // Set up daily interval
                window.reminderInterval = setInterval(showReminder, 24 * 60 * 60 * 1000);
            }, timeUntilReminder);
        }

        function showReminder() {
            if (!settings.reminders) return;
            
            // Check if notifications are supported
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Habit Tracker Reminder ‚è∞', {
                    body: settings.reminderMessage,
                    icon: 'https://cdn-icons-png.flaticon.com/512/3082/3082383.png'
                });
            }
            
            // Also show in-app notification
            showNotification(settings.reminderMessage, 'info');
        }

        function checkNotificationSupport() {
            if (!('Notification' in window)) {
                console.log('This browser does not support notifications');
                return false;
            }
            return true;
        }

        // Data Management
        function exportData() {
            const data = {
                habits,
                achievements,
                progressNotes,
                settings,
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `habit-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('This will replace all your current data. Continue?')) {
                            habits = data.habits || [];
                            achievements = data.achievements || [];
                            progressNotes = data.progressNotes || [];
                            settings = data.settings || settings;
                            
                            saveData();
                            initApp();
                            showNotification('Data imported successfully!', 'success');
                        }
                    } catch (error) {
                        alert('Error importing data: Invalid file format');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('This will delete ALL your habits, achievements, and notes. This cannot be undone. Continue?')) {
                habits = [];
                achievements = [];
                progressNotes = [];
                localStorage.clear();
                initApp();
                showNotification('All data cleared', 'warning');
            }
        }

        function updateStorageStatus() {
            try {
                const used = JSON.stringify(localStorage).length;
                const limit = 5 * 1024 * 1024; // 5MB typical limit
                const percentage = Math.round((used / limit) * 100);
                const status = document.getElementById('storageStatus');
                
                if (percentage > 90) {
                    status.innerHTML = `Storage: <span style="color: #ff6b6b;">${percentage}% full</span>`;
                } else if (percentage > 70) {
                    status.innerHTML = `Storage: <span style="color: #feb41c;">${percentage}% full</span>`;
                } else {
                    status.innerHTML = `Storage: <span style="color: #43e97b;">${percentage}% full</span>`;
                }
            } catch (e) {
                console.log('Could not calculate storage usage');
            }
        }

        // Offline Support
        function checkOfflineStatus() {
            const status = document.getElementById('offlineStatus');
            
            function updateStatus() {
                if (navigator.onLine) {
                    status.textContent = '‚úÖ Online';
                    status.className = 'offline-status online';
                } else {
                    status.textContent = '‚ö†Ô∏è Offline - Working locally';
                    status.className = 'offline-status offline';
                }
            }
            
            updateStatus();
            window.addEventListener('online', updateStatus);
            window.addEventListener('offline', updateStatus);
        }

        // Dark Mode
        document.getElementById('darkModeToggle').addEventListener('click', function() {
            settings.darkMode = !settings.darkMode;
            document.body.classList.toggle('dark-mode');
            this.textContent = settings.darkMode ? '‚òÄÔ∏è' : 'üåô';
            saveData();
            
            // Update charts for dark mode
            if (chart) chart.destroy();
            if (weeklyChart) weeklyChart.destroy();
            updateCharts();
        });

        // Utility Functions
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 12px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                animation: slideInRight 0.3s ease;
            `;
            
            // Set background based on type
            if (type === 'success') {
                notification.style.background = 'linear-gradient(45deg, #43e97b, #36d399)';
            } else if (type === 'warning') {
                notification.style.background = 'linear-gradient(45deg, #feb41c, #ff9a3c)';
            } else if (type === 'error') {
                notification.style.background = 'linear-gradient(45deg, #ff6b6b, #ff5252)';
            } else {
                notification.style.background = 'linear-gradient(45deg, #4facfe, #00f2fe)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
            
            // Add CSS for animations
            if (!document.getElementById('notificationStyles')) {
                const style = document.createElement('style');
                style.id = 'notificationStyles';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
            selectedHabitId = null;
        }

        function saveData() {
            localStorage.setItem('habits', JSON.stringify(habits));
            localStorage.setItem('achievements', JSON.stringify(achievements));
            localStorage.setItem('progressNotes', JSON.stringify(progressNotes));
            localStorage.setItem('settings', JSON.stringify(settings));
            updateStorageStatus();
        }

        // Service Worker for PWA (Progressive Web App)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // Prevent accidental closing with unsaved data
        window.addEventListener('beforeunload', function(e) {
            saveData();
        });
    </script>
</body>
</html>